# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## AI Warning
A lot of this content has been generated by AI using context to the codebase.
There may be some mistakes. YMMV. Please let me know if anything looks strange or off.



## [Unreleased]

### Breaking
- Removed legacy diagnostics interface and implementation:
  - Blazor.WhyDidYouRender.Diagnostics.IErrorTracker
  - Diagnostics/ErrorTracker and Diagnostics/ErrorTrackerAdapter
- Removed legacy tracking logger surface:
  - Abstractions/ITrackingLogger
  - Services/ServerTrackingLogger and Services/WasmTrackingLogger

### Changed
- Core now uses async Abstractions.IErrorTracker exclusively
- RenderTrackerService relies only on unified logging (Logging.IWhyDidYouRenderLogger)
- ServiceCollectionExtensions simplified; initializes new error tracker on RenderTrackerService
- Samples updated to use async error tracker methods
- Pinned .NET SDK to 9.0.200 in global.json
- WASM: Browser storage has been removed; session IDs are ephemeral (in-memory).
- State tracking: honor `[TrackState]` and `[IgnoreState]` precedence over heuristics and improve collection content comparison to avoid false "unnecessary re-render" signals.
- Frequent re-render detection: tighten render frequency stats used to flag components as frequent re-renderers.

### Added
- AspireExtensions: useful entry point for .NET Aspire/OpenTelemetry scenarios
- ConsoleWhyDidYouRenderLogger as a safe fallback when MEL logger is unavailable
- Extensive logger parity tests to keep server structured logging, console output, and browser console logging in sync for:
  - unnecessary and frequent re-renders
  - parameter/state change tables and complex-object comparison output

### Removed
- Sample Diagnostics.razor dashboard and all references/links; prefer Aspire/OTel and console-based diagnostics
- WebAssembly browser storage (localStorage/sessionStorage) support; JSInterop retained only for browser console logging

## [3.0.0] - 2025-08-09

### üÜï Added
- Optional **.NET Aspire / OpenTelemetry** integration:
  - Structured logs via ILogger (appear in Aspire Structured)
  - Traces via ActivitySource (WhyDidYouRender.Render spans with wdyrl.* tags)
  - Metrics via Meter (wdyrl.renders, wdyrl.rerenders.unnecessary, wdyrl.render.duration.ms)
- Composite logger that emits both structured logs and OTel telemetry
- Log ‚Üî trace correlation: structured logs are emitted under an active Activity so ‚ÄúView structured logs‚Äù from a span shows results
- Documentation: README section covering Aspire setup, verification, and troubleshooting

- Internal logging refactor: unified IWhyDidYouRenderLogger, Composite logger, and Activity-scoped structured logging


### üîß Changed
- Default behavior remains the same unless `EnableOpenTelemetry = true` is set in configuration
- Minor internal refactors to enable correlation and richer span attributes

### üîÑ Migration
- No breaking changes expected for existing users. To enable Aspire/OTel, set in AddWhyDidYouRender:
  - `EnableOpenTelemetry = true`, `EnableOtelLogs = true`, `EnableOtelTraces = true`, `EnableOtelMetrics = true`
- Ensure your host wires OTel with:
  - Tracing AddSource("Blazor.WhyDidYouRender")
  - Metrics AddMeter("Blazor.WhyDidYouRender")
  - OTLP exporter enabled (Aspire service defaults does this automatically)

## [2.1.1] - 2025-08-03
### üêõ Fixed
- Incorrect handling on detecting state changes due to a duplicate call in a child method
  - this led to "unnecessary re-render" being shown in the logs when the change was, in fact, necessary

## [2.1.0] - 2025-07-29

### üÜï Added
- **Advanced State Tracking System**: Field-level change detection with automatic and manual tracking
- **New Attributes**:
  - `[TrackState]` - Mark fields/properties for explicit state tracking
  - `[IgnoreState]` - Exclude fields from state tracking with optional reasons
  - `[StateTrackingOptions]` - Component-level configuration overrides
- **Enhanced Configuration Options**:
  - `EnableStateTracking` - Enable/disable field-level state change tracking
  - `AutoTrackSimpleTypes` - Auto-track simple value types (string, int, bool, etc.)
  - `MaxTrackedFieldsPerComponent` - Limit fields per component for performance
  - `LogDetailedStateChanges` - Log detailed before/after values for state changes
  - `TrackInheritedFields` - Track fields inherited from base classes
  - `MaxStateComparisonDepth` - Maximum depth for object comparison
  - `EnableCollectionContentTracking` - Track changes within collection contents
  - `StateSnapshotCleanupIntervalMinutes` - Interval for cleaning up old state snapshots
  - `MaxStateSnapshotAgeMinutes` - Maximum age for state snapshots before cleanup
  - `MaxTrackedComponents` - Maximum number of components to track simultaneously
  - `ExcludeFromStateTracking` - Exclude specific component types from state tracking
- **New Data Models**:
  - `StateChange` - Represents a change in component state
  - `StateSnapshot` - Captures component state at a specific point in time
  - Enhanced `RenderEvent` with `StateChanges` property
- **Performance Features**:
  - Thread-safe state tracking for Blazor Server scenarios
  - Configurable memory management and cleanup
  - Performance optimization options for high-load scenarios
- **Component-Level Configuration**: Fine-grained control over state tracking per component
- **Enhanced Console Output**: State changes now included in render tracking logs

### üîß Changed
- **License**: Changed from GNU GPL v3 to GNU LGPL v3 to allow closed source projects to use the library
- **Documentation**: Comprehensive updates across all documentation files
- **Configuration**: Extended `WhyDidYouRenderConfig` with state tracking options
- **Examples**: Added state tracking examples and configuration patterns

### üöÄ Performance
- Optimized state comparison algorithms with configurable depth limits
- Implemented efficient cleanup mechanisms for state snapshots
- Added performance monitoring for state tracking operations
- Thread-safe implementation for concurrent access scenarios

## [2.0.0] - 2025-07-20

### üÜï Added
- **Cross-Platform Support**: Full support for Blazor WebAssembly alongside existing Server/SSR support
- **Automatic Environment Detection**: Automatically detects and adapts to hosting environment
- **Browser Console Logging**: Rich logging output in browser developer tools
- **WASM Storage Support**: localStorage/sessionStorage integration for WebAssembly environments
- **New Configuration Options**:
  - `AutoDetectEnvironment` - Automatically detect hosting model
  - `ForceHostingModel` - Override automatic environment detection
  - `Output = TrackingOutput.Both` - Output to both server and browser console
  - `WasmStorageEnabled` - Enable browser storage for WASM environments
  - `WasmStorageOptions` - Configure WASM storage behavior
- **Environment-Specific Services**:
  - `ServerSessionContextService` / `WasmSessionContextService`
  - `ServerTrackingLogger` / `WasmTrackingLogger`
  - `ServerErrorTracker` / `WasmErrorTracker`
- **New Initialization Methods**:
  - `InitializeServerAsync()` - For Blazor Server environments
  - `InitializeWasmAsync()` - For WebAssembly environments
  - `InitializeSSRServices()` - For SSR environments

### üîß Changed
- **Architecture**: Redesigned with cross-platform abstraction layer
- **Service Registration**: Enhanced service collection extensions for multi-platform support
- **Session Management**: Platform-specific session handling (HttpContext vs Browser Storage)
- **Error Tracking**: Environment-aware error tracking and reporting

### ‚ùå Removed
- (none)

### üìö Documentation
- Clarified that the legacy diagnostics endpoint was already removed prior to v1.0; migration notes updated accordingly

### üîÑ Migration Required
- Add explicit initialization calls after service registration
- Remove diagnostics endpoint configuration and middleware
- Update output configuration to use new `TrackingOutput.Both` option

## [1.0.0] - 2025-07-19

### üéâ Initial Release
- **Core Render Tracking**: Monitor when and why Blazor components re-render
- **Parameter Change Detection**: Identify which parameter changes trigger re-renders
- **Performance Metrics**: Track render duration and frequency
- **Unnecessary Render Detection**: Find components that re-render without actual changes
- **Blazor Server Support**: Full support for Blazor Server applications
- **SSR Support**: Server-Side Rendering compatibility
- **Component Base Class**: `TrackedComponentBase` for easy integration
- **Configuration System**: Flexible configuration options via `WhyDidYouRenderConfig`
- **Console Logging**: Detailed render tracking output
- **Session Management**: HttpContext-based session tracking
- **Error Diagnostics**: Built-in error tracking and diagnostics endpoint

### üîß Configuration Options
- `Enabled` - Enable/disable tracking
- `Verbosity` - Control logging detail level
- `Output` - Configure output destinations
- `TrackParameterChanges` - Enable parameter change detection
- `TrackPerformance` - Enable performance tracking
- `IncludeSessionInfo` - Include session information in logs

---

## Legend

- üÜï **Added** - New features
- üîß **Changed** - Changes in existing functionality
- ‚ùå **Removed** - Removed features
- üêõ **Fixed** - Bug fixes
- üöÄ **Performance** - Performance improvements
- üîÑ **Migration Required** - Breaking changes requiring user action
- üéâ **Major Milestone** - Significant releases
